<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Chatroom React</title>
    <link rel="stylesheet" href="css/base.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.15/browser.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script>


  </head>
  <body >
    <div id="content"></div>
   <script src="/socket.io/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
    <script type="text/babel">


//socket
  // var socket=io();
  // $('form').submit(function(){
  //   //console.log("I submitted");
  //   socket.emit('seen', $('#fakeid').val());
  //   $('#fakeid').val('');
  //   return false;
  // });
  // socket.on('status',function(obj){
  //   console.log(obj.id+" is online? "+obj.status);
  // })



// var data = [
//   {id: 1, Name: "Yufan Sun", Status: "true"},
//   {id: 2, Name: "Qinye Li", Status: "false"},
//   {id: 3, Name: "Yanda Huang", Status: "true"},
//   {id: 4, Name: "Shengjie Pan", Status: "false"},
//   {id: 5, Name: "Shuoyang Cui", Status: "false"}
// ];
var data = [
  {id: 1, Name: "No one", Status: "true"},
  {id: 2, Name: "Qinye Li", Status: "false"}
];

var socket=io();
socket.emit('chat message',"Yufan Sun is here");
socket.emit('seen',data[0].id);
socket.emit(data[0].id,data[0].Name);
socket.on('status',function(obj){
    console.log(obj.id+" is online? "+obj.Status);
    console.log(data[obj.id].Status);
  })



var Wrapper = React.createClass({
    getInitialState: function() {
    return {data: data};
  },

  componentDidMount: function () {
    var _this=this;
    socket.on('initialStatus',function(initialStatus){
      console.log("Initial State");
      //console.log(data[obj.id].Status);
      _this.setStatus({data:initialStatus});
    })
  },

  render: function(){
    console.log("hahahah "+data[0].Status);
    return(
      <div className="wrapper">
      <h1>StuffPass</h1>
      <ContactBox data={this.state.data}/>
      <InputBox />
      </div>
      );
  }
});

var ContactBox = React.createClass({
  getInitialState: function() {
    return {data: data};
  },
  render: function() {
    return (
      <div style={Background_ContactBox} className="contactBox">
        <h2>Recent Contacts</h2>
        <ContactList data={this.state.data} />
      </div>
    );
  }
});


var ContactList = React.createClass({
  getInitialState: function() {
    return {data: data};
  },
  render: function() {
        var contactNodes = this.state.data.map(function(contact) {
      return (
        <Contact Name={contact.Name} key={contact.id} Status={contact.Status}>
          {contact.Status}
        </Contact>
      );
    });
    return (
      <div style={Background_ContactList} className="contactList">
        {contactNodes}
      </div>
    );
  }
});



var Contact = React.createClass({
  render: function() {
    if (this.props.Status=="true"){
    return (      
      <div style={Background_Contacts} className="contact">
        <span style={StatusTrue}>
        O  
        </span>
        <span className="contactName">
          {this.props.Name}
        </span>
        <b style={Badge}> </b>
      </div>
      
    );} else{
      return(
      <div style={Background_Contacts} className="contact">
      <span style={StatusFalse}>
       O 
        </span>
        <span className="contactName">
          {this.props.Name}
        </span>
      </div>
        );}
  }
});


var InputBox = React.createClass({
  render: function(){
    return (
      <form className="inputBox">
      <input type="text" placeholder="Say something..." />
      <input type="submit" value="Send" />
      </form>
      );
  }
});

//********************UI**********************
var StatusTrue = {
   color: 'green'
 };
 var StatusFalse = {
   color: 'red'
 };
 var Background_Contacts = {
  //backgroundColor: '#F0F0F0',
  //marginRight: 900
  fontSize: 20
 };
  var Background_ContactBox = {
  backgroundColor: '#3a3f51',
  color: '#a6a8b1',
  marginRight: 900
 };
 var Background_ContactList = {
  //backgroundColor: '#F0F0F0'
 };
 var Badge = {
  // display: inline-block,
  //   min-width: 10px,
  //   padding: 3px 7px,
    color: '#fff'
    // text-align: center,
    // white-space: nowrap,
    // vertical-align: baseline,
    // background-color: #777,
    // border-radius: 10px
 };
ReactDOM.render(
  <Wrapper data={data} />,
  document.getElementById('content')
);  
    </script>
  </body>
</html>

