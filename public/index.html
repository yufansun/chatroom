<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Chatroom React</title>
    <link rel="stylesheet" href="css/base.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react-dom.js"></script>



  </head>
  <body >
    <div id="content"></div>
   <script src="/socket.io/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
    <script type="text/babel">


//socket
  // var socket=io();
  // $('form').submit(function(){
  //   //console.log("I submitted");
  //   socket.emit('seen', $('#fakeid').val());
  //   $('#fakeid').val('');
  //   return false;
  // });
  // socket.on('status',function(obj){
  //   console.log(obj.id+" is online? "+obj.status);
  // })



var socket=io();
socket.emit('myID',"Yufan");
var Wrapper = React.createClass({

  render: function(){
    return(
      <div className="wrapper">
      <h1>StuffPass</h1>
      <ContactBox/>
      <h2>Chatting Part</h2>
      //<Chat />
      </div>
      );
  }
});

var ContactBox = React.createClass({
  getInitialState: function() {
    //return {data: data};
    return {dataState: [{ key:0, Name:"No one", Statue: "false"}] }
        
  },
   componentDidMount: function () {
    var _this=this;
    socket.on('initialStatus',function(initialStatus){
      console.log("Initial State");
      //console.log(data[obj.id].Status);
      _this.setState({dataState:initialStatus});
    })
  },
  render: function() {
    return (
      <div style={Background_ContactBox} className="contactBox">
        <h2>Recent Contacts</h2>
        <ContactList data={this.state.dataState} />
      </div>
    );
  }
});


var ContactList = React.createClass({
  // getInitialState: function() {
  //   return {data: data};
  // },
  render: function() {
        var contactNodes = this.props.data.map(function(contact) {
      return (
        <Contact Name={contact.Name} key={contact.id} Status={contact.Status}>
          {contact.Status}
        </Contact>
      );
    });
    return (
      <div style={Background_ContactList} className="contactList">
        {contactNodes}
      </div>
    );
  }
});



var Contact = React.createClass({
  render: function() {
    if (this.props.Status=="true"){
    return (      
      <div style={Background_Contacts} className="contact">
        <span style={StatusTrue}>
        O  
        </span>
        <span className="contactName">
          {this.props.Name}
        </span>
        <b style={Badge}> </b>
      </div>
      
    );} else{
      return(
      <div style={Background_Contacts} className="contact">
      <span style={StatusFalse}>
       O 
        </span>
        <span className="contactName">
          {this.props.Name}
        </span>
      </div>
        );}
  }
});







// var MessageBox = React.createClass({
//   handleCommentSubmit: function(comment) {
//     // TODO: submit to the server and refresh the list
//   },
//     render: function() {
//     return (
//       <div className="messageBox">
//         <h3>Chat Message</h3>
//         <InputBox onMsgSubmit={this.handleSubmit} />
//       </div>

//     );
//   }
// })

// var MessageList = React.createClass({

//   render: function() {
//         var messageNodes = this.props.msg.map(function(message) {
//       return (
//         <Message Msg={message.msg} Sender={message.id}>
//         </Message>
//       );
//     });
//     return (
//       <div className="messageList">
//         {messageNodes}
//       </div>
//     );
//   }
// });

// var Message = React.createClass({
//   render: function() {
//     return (      
//       <div className="message">
//         <span>
//           {this.props.Msg}
//         </span>
//       </div>
      
//     );
//   }
// });

// var InputBox = React.createClass({
//   getInitialState: function(){
//     return {sender: '', msg: ''};
//   },
//   handleMsgChange: function(e){
//     this.setState({msg: e.target.value});
//   },
//   handleSubmit: function(e){
//     //may have error because I didn't implement this function
//     e.preventDefault();
//     var msg = this.state.msg.trim();
//     if(!msg){
//       return;
//     }

//     var messages = this.state.msg;
//     msg.id = Date.now();
//     var newMessages = messages.concat([message]);
//     this.setState({msg: newMessages});


//     socket.emit("chat message", msg);
//     console.log("chat message: "+msg+" sent!");
//     this.props.onMsgSubmit({msg: msg});
//     this.setState({msg:''});
//   },
//   render: function(){
//     return (
//       <form className="inputBox" onSubmit={this.handleSubmit}>
//       <input 
//       type="text" 
//       placeholder="Say something..." 
//       //may have some bugs with state
//       value={this.state.msg}
//       onChange={this.handleMsgChange}/>
//       <input type="submit" value="Send" />
//       </form>
//       );
//   }
// });







var InputBox = React.createClass({
  getInitialState() {
    return {
      messages: [],
      userName: ''
    }
  },
  componentWillMount() {
    let socket = io();
  },
  componentDidMount() {
    var username = '';

    do {
      username = prompt('Enter name:');
    } while (!username.length);

    this.setState({
      userName: username
    });
  },
  change() {
    this.setState({
      messages: Store.get()
    });
  },
  sendMessage(e) {
    e.preventDefault();
    let from = this.state.userName;
    let text = this.refs['msg'].getDOMNode().value;
    let timestamp = Date.now();

    if(!from.length || !text.length) {
      alert('Name and message is required');
      return;
    }

    this.refs['form'].getDOMNode().reset();
  },
  render() {
    return <div>
      <ul className="messages" ref='messages'>
        {this.state.messages.map((msg, k) => {
          return <li key={k}><span className='msgSender'>{msg.from}:</span> {msg.text}</li>
        })}
      </ul>
      <form className='form' ref='form'>
        <input autoComplete="off" className='msg' placeholder='message' ref='msg' />
        <button onClick={this.sendMessage}>Send</button>
      </form>
    </div>;
  }
});



//********************UI**********************
var StatusTrue = {
   color: 'green'
 };
 var StatusFalse = {
   color: 'red'
 };
 var Background_Contacts = {
  //backgroundColor: '#F0F0F0',
  //marginRight: 900
  fontSize: 20
 };
  var Background_ContactBox = {
  backgroundColor: '#3a3f51',
  color: '#a6a8b1',
  marginRight: 900
 };
 var Background_ContactList = {
  //backgroundColor: '#F0F0F0'
 };
 var Badge = {
  // display: inline-block,
  //   min-width: 10px,
  //   padding: 3px 7px,
    color: '#fff'
    // text-align: center,
    // white-space: nowrap,
    // vertical-align: baseline,
    // background-color: #777,
    // border-radius: 10px
 };
ReactDOM.render(
  <Wrapper/>,
  document.getElementById('content')
);  
    </script>
  </body>
</html>
